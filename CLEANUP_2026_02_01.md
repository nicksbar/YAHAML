# Code Cleanup - February 1, 2026

## Summary
Comprehensive cleanup of deprecated code, missing API endpoints, and outdated documentation following the Location model refactoring.

## Changes Made

### 1. Removed Dead Code
- **Deleted**: `saveStationLocation()` function in `ui/src/App.tsx` (lines 2551-2584)
  - Function was never called
  - Referenced non-existent `stationLocationName` variable
  - Attempted to save location fields directly to Station model (now deprecated)

### 2. Fixed Missing API Endpoint
- **Added**: `PATCH /api/stations/:callsign` endpoint in `src/index.ts`
  - Required by `saveStationDetails()` function in UI
  - Updates: name, class, section (deprecated), locationId, clubId
  - Returns updated station object
  
### 3. Updated Station API Endpoints
- **Modified**: `POST /api/stations` 
  - Removed deprecated `section` and `grid` parameters
  - Added `locationId` parameter to link to Location model
  
- **Modified**: `GET /api/stations` and `GET /api/stations/:id`
  - Added `location` to includes for proper relation loading
  - Ensures station location data is available in responses

### 4. Updated Documentation
- **Updated**: `docs/architecture.md`
  - Documented new Location model architecture
  - Listed all API endpoints with current parameters
  - Explained Station → Location relationship
  - Added integration points (HamDB, OSM Nominatim)
  - Removed "Draft" status and outdated service descriptions

### 5. Schema Cleanup Notes
The following fields in the Station model are marked deprecated but retained for backward compatibility:
- `section` (String?) - Use `location.section` instead
- `grid` (String?) - Use `location.grid` instead

These can be removed in a future breaking change release once all clients migrate to using the Location model.

## Test Coverage
- All 213 tests passing
- New Location API tests added (25 tests)
- No regressions from cleanup

## API Changes Summary

### New Endpoints
- `PATCH /api/stations/:callsign` - Update station details

### Modified Endpoints  
- `POST /api/stations` - Now accepts `locationId` instead of `section`/`grid`
- `GET /api/stations` - Now includes `location` relation
- `GET /api/stations/:id` - Now includes `location` relation

### Deprecated Parameters (Still Supported)
- `section` in `PATCH /api/stations/:callsign` - Use Location model instead
- `grid` in POST/PATCH station endpoints - Use Location model instead

## Migration Path for Deprecated Fields

For existing stations with `section` or `grid` values:
1. Create a Location record with those values
2. Update the Station's `locationId` to reference the new Location
3. Optionally clear the deprecated `section`/`grid` fields

Example:
```typescript
// Create location from station data
const location = await prisma.location.create({
  data: {
    name: `${station.callsign} - Default`,
    grid: station.grid,
    section: station.section,
  },
});

// Link station to location
await prisma.station.update({
  where: { id: station.id },
  data: {
    locationId: location.id,
    grid: null, // Clear deprecated field
    section: null, // Clear deprecated field
  },
});
```

## Benefits
- ✅ Removed 40+ lines of dead code
- ✅ Fixed critical missing API endpoint
- ✅ Improved API consistency (all Station endpoints now include Location)
- ✅ Updated documentation to reflect current architecture
- ✅ Clear migration path for deprecated fields
- ✅ All tests passing (213/213)
